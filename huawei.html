<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
	<title>华为加油！</title>
	<style>
		*{margin: 0;padding: 0;}
		body{
			font-size: 0;
		}
		canvas{
			background: #000;
		}
	</style>
</head>
<body>
	<canvas id='canvas'></canvas>
	<script src='./js/tween.js?t=2'></script>
	<script>
		
		(function(document){

			class Point{
				constructor(option){
					this.x = option.x || 0;
					this.y = option.y || 0;
					this.r = option.r || 2;
					this.x3d = 0;
				    this.y3d = 0;
				    this.z3d = 0;
				    this.viewH = window.innerHeight;
					/*this.speedX = - Math.random()*2 - 2;
					this.speedY = - Math.random() * 30;*/
					this.vx = Math.random() - .5> 0 ? Math.random()*1 : -Math.random()*1;
				    this.vy = Math.random() * 5  + 1;
				    this.vz = 0;
				    this.scaleX = option.scaleX || 1;
    				this.scaleY = option.scaleY || 1;
					this.g = 2;
					this.fillStyle = option.fillStyle || 'red';

				}
				render(context){

					var {x , y ,r,speedX,speedY,g,fillStyle,scaleX, scaleY} = this;
					context.save();
					context.scale(scaleX, scaleY);
					context.beginPath();
					context.arc(x,y,r,0,Math.PI*2,false);
					context.closePath();
					context.fillStyle = fillStyle;
					context.fill();
					context.restore();
					return this;
 				}

 				scaleAnimate(context){

 					this.scaleX +=.01;
 					this.scaleX = this.scaleX>1?1:this.scaleX;
 					this.scaleY = this.scaleX;
 					//this.render(context);

 				}
 				posAnimate(context,target){ //target 目标点。
 					
 					this.x += this.vx;
 					this.y += this.vy;
 					this.render(context);
 					if(this.y  + this.r > this.viewH){
 						this.y = Math.random() * 400 * -1 - 100;
 						this.vy = Math.random() * 5 + 1;

 					}
 				}
			}


			var util = {
				viewW:window.innerWidth,
				viewH:window.innerHeight ,
				init(){
					this.setSize();
					
				},
				setSize(){
					var canvas = document.querySelector('#canvas');
					var context = canvas.getContext('2d');
					this.context = context;
					var {viewW , viewH } = this;
					canvas.width = this.viewW;
					canvas.height = this.viewH;
					var s = this;

					var offCanvas = document.createElement('canvas');
					offCanvas.width = this.viewW;
					offCanvas.height = this.viewH;

					var offContext = offCanvas.getContext('2d');
					this.offContext = offContext;

					var t = setInterval(()=>{
					},1000)
						this.drawClock();

					 
				},

				pointsPos:[],

				pointsPos3d:[],

				points:[],



				drawClock(){

					
				
					var {offContext,context,viewW,viewH,pointsPos,points,pointsPos3d} = this;
					var gap = (viewW - 1250) / 2;
					
					offContext.clearRect(0,0,viewW,viewH);
					
					offContext.font = '250px 华文楷体';
					offContext.textBaseline  = 'top';
					var startX =(viewW - 1150) / 2;;
					var lingrad = offContext.createLinearGradient(0,0,viewW,viewH);
						lingrad.addColorStop(0,'#06f411');
						lingrad.addColorStop(1,'#fd2508');
					offContext.fillStyle = lingrad;

					var text = '华为加油！'

					offContext.fillText(text,startX,20);

				

					var imgData = offContext.getImageData(0,0,viewW,viewH);

					var {width,height,data} = imgData;

					var margin = 4;

					for(var i = 0 ;i < width; i+= margin ){
						for(var j = 0 ; j < height ; j+=margin){
							var a = (i +j * width) *4
							if(data[a + 3] > 128 ){
								pointsPos.push({
									x:i,
									y:j,
									r:data[a + 0],
									g:data[a + 1],
									b:data[a + 2],
									a:data[a + 3]
								})
							}
						}
					}

					 

					var f = viewH /12;

					 
					pointsPos.forEach((p,i)=>{
						var {x,y,r,g,b,a} = p;
						 


						var point = new Point({
							x,//:Math.random()*viewW,
							y,//:-Math.random()*500 - 100,//: 1400,//Math.random()*viewH *1.5 - r,
							//scaleX:scale,
							//scaleY:scale,
							//r :5,
							fillStyle:'rgba('+r+','+g+','+b+','+a+')'
						}).render(context);

						points.push(point);
						

					})

					///context.putImageData(imgData,0,0);



					setTimeout(()=>{

						var sqrt = Math.sqrt;
						var random = Math.random;

						(function render(){
							
							requestAnimationFrame(render);
							context.clearRect(0,0,viewW,viewH);
							points.forEach((point,index)=>{ 
								 point.posAnimate(context);

							})



						})()

					},1000);






				}
				 
			}
			util.init();

		})(document);

	</script>
</body>
</html>